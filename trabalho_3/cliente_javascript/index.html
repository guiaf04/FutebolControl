<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Futebol Control - Cliente Web</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; }
    input, button { margin: 5px 0; padding: 5px; width: 100%; }
    h2 { border-top: 1px solid #ccc; padding-top: 10px; }
    textarea { width: 100%; height: 200px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Futebol Control - Cliente Web</h1>

  <h2>Criar Clube</h2>
  <input type="text" id="clubeNome" placeholder="Nome do Clube">
  <input type="text" id="clubeSigla" placeholder="Sigla do Clube (ex: UFC)">
  <button onclick="criarClube()">Criar Clube</button>

  <h2>Ver Estatísticas do Clube</h2>
  <input type="text" id="estatSigla" placeholder="Sigla do Clube">
  <button onclick="verEstatisticas()">Ver Estatísticas</button>

  <h2>Atualizar Clube</h2>
  <input type="text" id="putSiglaOriginal" placeholder="Sigla original do clube">
  <input type="text" id="putNome" placeholder="Novo nome do clube">
  <input type="text" id="putNovaSigla" placeholder="Nova sigla do clube">
  <button onclick="atualizarClube()">Atualizar Clube</button>

  <h2>Deletar Clube</h2>
  <input type="text" id="delSigla" placeholder="Sigla do clube a deletar">
  <button onclick="deletarClube()">Deletar Clube</button>

  <h2>Criar Campeonato</h2>
  <input type="text" id="campNome" placeholder="Nome do Campeonato">
  <input type="number" id="campAno" placeholder="Ano do Campeonato">
  <button onclick="criarCampeonato()">Criar Campeonato</button>

  <h2>Atualizar Campeonato</h2>
  <input type="text" id="putCampNomeOriginal" placeholder="Nome original do campeonato">
  <input type="text" id="putCampNovoNome" placeholder="Novo nome do campeonato">
  <input type="number" id="putCampNovoAno" placeholder="Novo ano do campeonato">
  <button onclick="atualizarCampeonato()">Atualizar Campeonato</button>

  <h2>Deletar Campeonato</h2>
  <input type="text" id="delCampNome" placeholder="Nome do campeonato a deletar">
  <button onclick="deletarCampeonato()">Deletar Campeonato</button>

  <h2>Adicionar Clube ao Campeonato</h2>
  <input type="text" id="addCampNome" placeholder="Nome do Campeonato">
  <input type="text" id="addClubeSigla" placeholder="Sigla do Clube">
  <button onclick="adicionarClubeAoCampeonato()">Adicionar Clube</button>

  <h2>Ver Clubes de Campeonato</h2>
  <input type="text" id="listCampClubesNome" placeholder="Nome do Campeonato">
  <button onclick="verClubesCampeonato()">Ver Clubes</button>

  <h2>Registrar Partida</h2>
  <input type="text" id="pClube1" placeholder="Sigla Clube 1">
  <input type="number" id="pGols1" placeholder="Gols Clube 1">
  <input type="text" id="pClube2" placeholder="Sigla Clube 2">
  <input type="number" id="pGols2" placeholder="Gols Clube 2">
  <input type="text" id="pCamp" placeholder="Nome do Campeonato">
  <button onclick="registrarPartida()">Registrar Partida</button>

  <h2>Ver Histórico do Clube</h2>
  <input type="text" id="histSigla" placeholder="Sigla do Clube">
  <button onclick="verHistorico()">Ver Histórico</button>

  <h2>Saída</h2>
  <textarea id="saida" readonly></textarea>

  <script>
    const API = "http://localhost:8000";

    async function criarClube() {
      const nome = document.getElementById("clubeNome").value;
      const sigla = document.getElementById("clubeSigla").value;
      const resposta = await fetch(`${API}/clubes`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nome, sigla })
      });
      const dados = await resposta.json();
      mostrar(dados);
    }

    async function verEstatisticas() {
      const sigla = document.getElementById("estatSigla").value;
      const resposta = await fetch(`${API}/clubes/estatisticas?sigla=${sigla}`);
      const dados = await resposta.json();
      mostrar(dados);
    }

    async function atualizarClube() {
      const siglaOriginal = document.getElementById("putSiglaOriginal").value;
      const nome = document.getElementById("putNome").value;
      const novaSigla = document.getElementById("putNovaSigla").value;

      const resposta = await fetch(`${API}/clubes?sigla_original=${siglaOriginal}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nome, sigla: novaSigla })
      });
      const dados = await resposta.json();
      mostrar(dados);
    }

    async function deletarClube() {
      const sigla = document.getElementById("delSigla").value;
      const resposta = await fetch(`${API}/clubes?sigla=${sigla}`, {
          method: "DELETE"
      });
      const dados = await resposta.json();
      mostrar(dados);
    }

    async function criarCampeonato() {
      const nome = document.getElementById("campNome").value;
      const ano = document.getElementById("campAno").value;
      const resposta = await fetch(`${API}/campeonatos`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nome, ano: parseInt(ano) })
      });
      const dados = await resposta.json();
      mostrar(dados);
    }

    async function atualizarCampeonato() {
        const nomeOriginal = document.getElementById("putCampNomeOriginal").value;
        const novoNome = document.getElementById("putCampNovoNome").value;
        const novoAno = document.getElementById("putCampNovoAno").value;

        // Primeiro, obter os dados atuais do campeonato para preservar os clubes
        const respostaGetCamp = await fetch(`${API}/campeonatos`); // Fetch all camps
        const campeonatosList = await respostaGetCamp.json();
        const campeonatoExistente = campeonatosList.find(c => c.nome === nomeOriginal);

        if (!campeonatoExistente) {
            mostrar({ mensagem: "Campeonato não encontrado." });
            return;
        }

        const corpoAtualizacao = {
            nome: novoNome || nomeOriginal, // Se novoNome vazio, usa o original
            ano: novoAno ? parseInt(novoAno) : campeonatoExistente.ano, // Se novoAno vazio, usa o original
            clubes: campeonatoExistente.clubes // Preserva os clubes existentes
        };
        
        const resposta = await fetch(`${API}/campeonatos?nome_original=${nomeOriginal}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(corpoAtualizacao)
        });
        const dados = await resposta.json();
        mostrar(dados);
    }

    async function deletarCampeonato() {
      const nome = document.getElementById("delCampNome").value;
      const resposta = await fetch(`${API}/campeonatos?nome=${nome}`, {
          method: "DELETE"
      });
      const dados = await resposta.json();
      mostrar(dados);
    }

    async function adicionarClubeAoCampeonato() {
      const nomeCampeonato = document.getElementById("addCampNome").value;
      const siglaClube = document.getElementById("addClubeSigla").value;
      const resposta = await fetch(`${API}/campeonatos/adicionar_clube?nome_campeonato=${nomeCampeonato}&sigla_clube=${siglaClube}`, {
        method: "POST"
      });
      const dados = await resposta.json();
      mostrar(dados);
    }

    async function verClubesCampeonato() {
      const nome = document.getElementById("listCampClubesNome").value;
      const resposta = await fetch(`${API}/campeonatos/clubes_participantes?nome=${nome}`);
      const dados = await resposta.json();
      mostrar(dados);
    }

    async function registrarPartida() {
      const sigla_clube1 = document.getElementById("pClube1").value;
      const sigla_clube2 = document.getElementById("pClube2").value;
      const gols1 = parseInt(document.getElementById("pGols1").value);
      const gols2 = parseInt(document.getElementById("pGols2").value);
      const campeonato = document.getElementById("pCamp").value;

      const resposta = await fetch(`${API}/partidas`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ sigla_clube1, sigla_clube2, gols1, gols2, campeonato })
      });
      const dados = await resposta.json();
      mostrar(dados);
    }

    async function verHistorico() {
      const sigla = document.getElementById("histSigla").value;
      const resposta = await fetch(`${API}/clubes/partidas?sigla=${sigla}`);
      const dados = await resposta.json();
      mostrar(dados);
    }

    function mostrar(obj) {
      document.getElementById("saida").value = JSON.stringify(obj, null, 2);
    }

  </script>
</body>
</html>